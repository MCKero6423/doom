<script type="module">
    import { Dos } from "https://js-dos.com/v7/js-dos.js";

    const canvas = document.getElementById("doom-canvas");
    
    // --- 代码修改从这里开始 ---

    // 粘贴你从GitHub Release复制的WAD文件URL
    const wadUrl = "https://js.mckero.com/freedoom1.wad";

    async function startDoom() {
        try {
            // 1. 初始化 js-dos 并加载 DOOM 引擎
            const ci = await Dos(canvas, {
                url: `https://js-dos.com/cdn/doom-1-shareware-bundle.jsdos`,
            });

            // 2. 从网络上获取WAD文件
            console.log(`Downloading WAD from ${wadUrl}...`);
            const response = await fetch(wadUrl);
            if (!response.ok) {
                throw new Error(`Failed to fetch WAD: ${response.statusText}`);
            }
            const wadData = await response.arrayBuffer();
            console.log("Download complete!");

            // 3. 将下载的WAD数据写入到模拟器的文件系统里
            // 我们给它起名为 "doom.wad"，这样DOOM引擎能找到它
            await ci.fs.writeFile("doom.wad", new Uint8Array(wadData));

            // 4. 运行DOOM，并用 -iwad 参数明确告诉它使用我们刚写入的文件
            // 这比之前的 ci.upload() 更强大
            await ci.run